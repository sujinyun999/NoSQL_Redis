# 6.1 복제 & 분산 시스템 개요

레디스는 **스케일 아웃** 기능인 파티셔닝을 제공

cf. **스케일 업** : 하나의 서버 내에서 시스템 자원을 최대한 확장하여 데이터를 저장, 관리하는 기술

**스케일 아웃** : 하나의 논리적인 테이블을 수대~수십대의 서버로 분산 저장, 데이터를 분리 저장하는 목적은 동일하지만 분산 방법은 완전 다름



> 데이터 분산 저장 목적

1. **자원 공유** : 하나의 서버에서 사용가능한 시스템 자원이 제한적, 한번에 많은 데이터를 다룰경우 과부화 발생 가능성
2. **성능 향상** : 연속적으로 발생하는 데이터 처리에 한계가오면, 일시적인 대기상태 발생, 그리고 시스템 전체의 성능 지연 => 로드밸런싱으로 다른서버에 연속적으로 데이터 저장
3. **안정성** : 특정 서버에 장애가 발생했을경우 데이터 복제로 유실방지

레디스에서의 데이터 복제, 분산처리 => 마스터-슬레이브, 마스터-슬레이브-센티널, 파티션 클러스트 기능

## 6.1.1 Partition 유형


1. **Range Partition** : Redis서버에 저장되는 key값을 기준으로 특정범위 데이터를 특정 파티션 서버로 분산 저장

2. **Hash Partition** : Range partitioning의 장점은 사용자가 지정한 서버로 특정 범위값 저장이 가능하다는 것, 단점은 각 샤드 서버에 저장되는 데이터 양에따라 분산율이 떨어지는 경우가 발생할 수 있다는 것, 이를 보완해 Hash algorithm에 의해 골고루 분산


## 6.1.2 Partition 구현 방법

1. **client side partitioning** : 데이터를 읽고 쓰는 클라이언트에서 해당 서버 직접 지정 및 처리, redis서버를 이용하는 대부분의 시스템 환경에서 보편적으로 사용하는 방법
  
     사용자의 능력에 따라 엄청 효과적일수도, 불편할 수도 있다, 쉽지않음

2. **proxy assisted partitioning** : 클라이언트는 proxy protocol로 구축된 proxy server를 통해 쓰고 읽기 작업에 대한 요청 수행, 결과 전달받음
  
    분산서버 이외에 프록시서버가 추가로 필요, 이때 프록시 서버는 현재 분산서버의 모든 상태 정보를 수집 및 저장해주고, 사용자가 대량의 데이터에 대한 저장을 요구하는 경우 가장 적절한 분산 서버를 찾아서 데이터 저장해줌 / 사용자가 특정 데이터를 검색할 경우 해당 데이터가 저장되어 있는 서버 정보를 분석한 후 데이터를 검색, 결과 리턴 => 별도 분리된 서버에 구축 권장

3. **query routing**: 읽고 쓰기 작업 수행 -> 임의의 서버로 전달, 데이터를 참조할 수 없는 경우 올바른 노드로 redirection(자동전환)되어 실행

    해시파티션으로 데이터 분산 저장, 특정 분산서버에 장애가 발생한 경우 사용가능한 slave서버를 통해 지속적인 읽기 작업 가능, 사용가능한 서버로 자동 전환해줌

#### *Redis 파티션의 단점 : 
   1. 레디스 서버 환경에서 파티셔닝 기능을 이용한 분산처리 기술의 사용은 적극적으로 권장하지 않는다,,,,,,,,,,,,,,,,,
   
      ex. 2개의 데이터셋이 여러개 인스턴스에 동시에 저장되어있는 경우 이를 효과적으로 처리하고 트랜잭션 제어까지 수행하는 것은 결코 쉬운 작업이 아니며 이를 완벽하게 지원하지도 않음

   2. 새로운 노드를 추가, 기존 노드를 실시간으로 제거하는 작업은 하나의 큰 파티션 영역을 새롭게 분할, 합병하는 작업이 빈번하게 요구되는데 이 경우 rdb와 aof파일을 백업하고 이전해야하기 때문에 이 작업들은 결코 쉬운 방법이 아님

   3. 런타임에서 노드추가, 제거 작업이 수행되는 단계에서 전체 서버의 균형을 맞추기 위한 리밸런싱 작업을 수행해야하는데 이를 처리하다 보면 성능 지연 문제 등 기술적 한계가 발생할 수 있음




